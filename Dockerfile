# Dockerfile
# Это инструкция/рецепт, из которого Docker создаёт образ (то есть какая будет программа, что в ней)
# В нём описано, что будет внутри образа, какие программы, библиотеки, файлы и настройки.
# Он сам по себе ещё не запускает контейнер, а только создаёт образ.
# 
# ---------------------------
# ЭТАП 1: Сборка проекта
# ---------------------------
# Берём официальный Node.js образ (нужен для сборки Vue)
FROM node:22 AS build 

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /client-vue-app

# Копируем package.json и package-lock.json для установки зависимостей
COPY package*.json ./

# Устанавливаем зависимости проекта
RUN npm install

# Копируем весь проект в контейнер
COPY . .

# Собираем Vue проект (результат будет в папке /client-vue-app/dist)
RUN npm run build

# ---------------------------
# ЭТАП 2: Сервер для отдачи файлов
# ---------------------------
# Берём лёгкий nginx для отдачи статики
FROM nginx:alpine

# Копируем готовую сборку Vue из первого этапа в nginx
COPY --from=build /client-vue-app/dist /usr/share/nginx/html

# Копируем наш nginx конфиг
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Открываем порт 80 внутри контейнера
EXPOSE 80

# Запускаем nginx в "foreground", чтобы контейнер работал постоянно
CMD ["nginx", "-g", "daemon off;"]